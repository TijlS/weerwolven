class UserPicker {
    /**
     * 
     * @param {HTMLDivElement} parent 
     * @param {Array} userList 
     * @param {String} mode 
     * @param {WebSocket} socket 
     */
    constructor(parent, userList, mode, socket, uuid) {
        this.parent = parent;
        this.users = userList;
        this.children = [];
        this.mode = mode;
        this.isDay = true;
        this.witchAction = 3;
        this.witchActionBar = null;
        this.root = document.createElement("ul");
        this.socket = socket;
        this.currentUuid = uuid;
        this.isDead = false

        initUserPicker(this);
    }

    show() {
        if(this.isDead) return;
        this.root.style.display = "block";
        this.children.forEach(child => {
            const btn = child.querySelector('button:not([data-current-user]):not([data-is-dead])')
            if(btn) btn.disabled = false;
        });
    }

    hide() {
        this.root.style.display = "none";
    }

    toggleTime(time) {
        this.isDay = time;
    }

    /**
     * @param {Array} users 
     */
    updateUsers(users) {
        this.users = users;
        updateUserPicker(this);
    }

    updateVotes(votes){
        updateVotesUI(this, votes)
    }

    hunterPick(){
        hunter(this)
    }

    die(){
        this.isDead = true
    }
    backAlive() {
        this.isDead = false
    }

}

/**
 * @param {UserPicker} UserPicker
 */
function initUserPicker(UserPicker) {
    UserPicker.root.style.display = "none";
    UserPicker.root.classList.add('choose-list');
    UserPicker.users.forEach((user) => {
        const $li = document.createElement("li");
        $li.classList.add('player');
        const $btn = document.createElement("button");
        const $playerIcon = document.createElement("div");
        $playerIcon.classList.add('player-icon');
        $playerIcon.innerHTML = user.isDead ? `<i class="fas fa-user-slash"></i>` : `<i class="fas fa-user"></i>`;
        const $userName = document.createElement('span');
        $userName.classList.add('userName');
        $userName.textContent = user.name;
        const $userVotes = document.createElement('div');
        $userVotes.classList.add('userVotes')
        $btn.dataset.userid = user.uuid;

        if (user.uuid == UserPicker.currentUuid) {
            $btn.dataset.currentUser = true
            $btn.disabled = true
        }else {
            $btn.addEventListener("click", () => {
                UserPickerClick(UserPicker, $btn, user, UserPicker.socket);
            });
        }

        if (user.isDead) {
            $btn.classList.add('dead')
            $btn.dataset.isDead = true
            $btn.disabled = true
        }
        $btn.append($playerIcon, $userName, $userVotes)
        $li.append($btn);
        UserPicker.children.push($li);
        UserPicker.root.append($li);
    });
    if (UserPicker.mode == "witch") {
        const $div = document.createElement('div')
        $div.classList.add('witch-picker')
        for (let i = 0; i < 3; i++) {
            const $btn = document.createElement('button')
            $btn.classList.add('witch-picker-button')
            $btn.addEventListener('click', () => {
                $div.querySelectorAll('button').forEach(btn => btn.classList.remove('toggle'));
                $btn.classList.add('toggle');
                UserPicker.witchAction = i;
            })
            switch (i) {
                case 0:
                    $btn.innerHTML = `<i class="fas fa-skull-crossbones fa-2x"></i>`
                    break;
                case 1:
                    $btn.innerHTML = `<i class="fas fa-ban fa-2x"></i>`
                    break;
                case 2:
                    $btn.innerHTML = `<i class="fas fa-heartbeat fa-2x"></i>`
                    break;
            }
            $div.appendChild($btn);
        }
        $div.classList.add('hidden')
        UserPicker.witchActionBar = $div
        UserPicker.parent.append($div)
    }
    UserPicker.parent.append(UserPicker.root)
}

/**
 * @param {UserPicker} UserPicker
 */
function updateUserPicker(UserPicker) {
    UserPicker.root.innerHTML = "";
    UserPicker.users.forEach((user) => {
        const $li = document.createElement("li");
        $li.classList.add('player');
        const $btn = document.createElement("button");
        const $playerIcon = document.createElement("div");
        $playerIcon.classList.add('player-icon');
        $playerIcon.innerHTML = user.isDead ? `<i class="fas fa-user-slash"></i>` : `<i class="fas fa-user"></i>`;
        const $userName = document.createElement('span');
        $userName.classList.add('userName');
        $userName.textContent = user.name;
        const $userVotes = document.createElement('div');
        $userVotes.classList.add('userVotes')
        $btn.dataset.userid = user.uuid;

        if (user.uuid == UserPicker.currentUuid) {
            $btn.dataset.currentUser = true
            $btn.disabled = true
        }else {
            $btn.addEventListener("click", () => {
                UserPickerClick(UserPicker, $btn, user, UserPicker.socket);
            });
        }

        if (user.isDead) {
            $btn.classList.add('dead')
            $btn.dataset.isDead = true
            $btn.disabled = true
        }
        $btn.append($playerIcon, $userName, $userVotes)
        $li.append($btn);
        UserPicker.children.push($li);
        UserPicker.root.append($li);
    });
}

//#region ROLES SVG
let rolesSVG = {
        werewolf: `<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
    viewBox="0 0 468.296 468.296" style="enable-background:new 0 0 468.296 468.296;" xml:space="preserve">
<g>
   <path style="fill:#2F4859;" d="M65.57,19.005l32.131,110.097l83.71-59.082L88.439,2.864C77.019-5.385,61.623,5.481,65.57,19.005z"
       />
   <path style="fill:#2F4859;" d="M402.726,19.005l-32.131,110.097l-83.71-59.082l92.972-67.155
       C391.277-5.385,406.673,5.481,402.726,19.005z"/>
</g>
<path style="fill:#3A556A;" d="M458.013,270.197c-18.959-15.91-35.422-34.787-48.606-55.732c11.501-4.564,23.002-9.127,34.504-13.69
   c-29.852-31.559-55.699-66.904-76.705-104.929c-4.285-7.757-9.148-15.234-15.213-21.696c-33.605-35.804-70.5-19.297-100.855,4.191
   c-10.057,7.782-23.924,7.782-33.981,0c-30.351-23.485-67.238-39.991-100.842-4.207c-6.067,6.461-10.931,13.937-15.216,21.694
   c-21.009,38.031-46.859,73.382-76.714,104.945c11.501,4.563,23.002,9.127,34.503,13.69c-13.184,20.945-29.647,39.822-48.605,55.732
   c8.556,1.829,16.449,6.619,22.02,13.364c-7.025,11.17-14.052,22.341-21.078,33.511c9.741,6.992,22.303,9.925,34.133,7.97
   c-6.074,7.654-5.437,19.811,1.404,26.788c6.842,6.977,18.983,7.852,26.755,1.929c-3.597,5.54-5.576,12.119-5.629,18.724
   c17.334,1.759,35.034-0.165,51.584-5.609c15.329,43.259,58.578,79.61,101.958,98.744c8.094,3.57,17.34,3.57,25.435,0
   c43.379-19.134,86.627-55.485,101.956-98.744c16.552,5.444,34.25,7.368,51.584,5.609c-0.054-6.605-2.03-13.184-5.629-18.724
   c7.772,5.923,19.914,5.047,26.755-1.929c6.841-6.977,7.479-19.134,1.404-26.788c11.83,1.955,24.393-0.979,34.134-7.97
   c-7.027-11.17-14.052-22.341-21.079-33.511C441.564,276.816,449.457,272.026,458.013,270.197z"/>
<path style="fill:#FCD462;" d="M349.905,218.128c0,25.912-20.979,46.892-46.892,46.892c-25.849,0-46.767-20.917-46.829-46.767
   l9.991-6.744l45.331-30.595l9.116-6.181C337.793,181.663,349.905,198.459,349.905,218.128z"/>
<path style="fill:#44C4A1;" d="M326.116,206.701c0,16.671-13.55,30.221-30.22,30.221c-15.048,0-27.473-11.052-29.721-25.413
   l45.331-30.595C320.247,186.159,326.116,195.712,326.116,206.701z"/>
<path style="fill:#2F4859;" d="M288.937,217.661c-7.25,0-13.848-3.797-17.671-9.594l35.21-23.764
   c2.424,3.468,3.764,7.642,3.764,12.061C310.24,208.108,300.683,217.661,288.937,217.661z"/>
<g>
   <circle style="fill:#D5D6DB;" cx="307.938" cy="205.976" r="7.099"/>
   <circle style="fill:#D5D6DB;" cx="282.925" cy="215.604" r="5.769"/>
</g>
<path style="fill:#FCD462;" d="M118.391,218.128c0,25.912,20.979,46.892,46.892,46.892c25.849,0,46.767-20.917,46.829-46.767
   l-9.991-6.744l-45.331-30.595l-9.116-6.181C130.503,181.663,118.391,198.459,118.391,218.128z"/>
<path style="fill:#44C4A1;" d="M142.18,206.701c0,16.671,13.55,30.221,30.22,30.221c15.048,0,27.473-11.052,29.721-25.413
   l-45.331-30.595C148.049,186.159,142.18,195.712,142.18,206.701z"/>
<path style="fill:#2F4859;" d="M179.359,217.661c7.25,0,13.848-3.797,17.671-9.594l-35.21-23.764
   c-2.424,3.468-3.764,7.642-3.764,12.061C158.056,208.108,167.613,217.661,179.359,217.661z"/>
<g>
   <circle style="fill:#D5D6DB;" cx="160.345" cy="205.976" r="7.099"/>
   <circle style="fill:#D5D6DB;" cx="185.383" cy="215.604" r="5.769"/>
</g>
<path style="fill:#E56353;" d="M232.414,279.011c-7.168-1.192-34.182-4.276-35.705,16.603c-0.101,1.379,0.124,2.757,0.558,4.07
   c1.976,5.98,9.365,22.868,32.052,33.296c3.058,1.406,6.6,1.406,9.658,0c22.688-10.428,30.077-27.316,32.053-33.296
   c0.434-1.313,0.658-2.691,0.558-4.07c-1.523-20.879-28.538-17.795-35.706-16.603C234.725,279.203,233.571,279.203,232.414,279.011z"
   />
<g>
   <ellipse style="fill:#2F4859;" cx="247.385" cy="300.29" rx="9.179" ry="13.262"/>
   <ellipse style="fill:#2F4859;" cx="220.917" cy="300.29" rx="9.179" ry="13.262"/>
   <path style="fill:#2F4859;" d="M285.062,387.525c0,0-3.684,11.239-15.047,21.729c-7.867,7.181-19.357,14.049-35.84,16.609
       c-16.485-2.56-27.973-9.366-35.84-16.609c-11.427-10.49-15.111-21.729-15.111-21.729c-7.742-19.793,7.805-20.605,7.805-20.605
       h86.229C277.257,366.92,292.804,367.732,285.062,387.525z"/>
</g>
<path style="fill:#E56353;" d="M270.014,409.253c-2.248,1.998-4.745,3.996-7.556,5.869c-7.181,4.87-16.422,8.929-28.284,10.74
   c-11.864-1.873-21.168-5.869-28.348-10.74c-2.809-1.873-5.308-3.871-7.492-5.869c3.558-7.617,11.301-12.862,20.23-12.862
   c6.056,0,11.55,2.435,15.61,6.306c3.995-3.871,9.49-6.306,15.547-6.306C258.65,396.391,266.392,401.636,270.014,409.253z"/>
<path style="fill:#D15241;" d="M262.459,415.123c-7.181,4.87-16.422,8.929-28.284,10.74c-11.864-1.873-21.168-5.869-28.348-10.74
   c3.621-2.497,7.992-3.996,12.738-3.996c6.056,0,11.55,2.435,15.61,6.306c3.995-3.871,9.49-6.306,15.547-6.306
   C254.467,411.127,258.838,412.563,262.459,415.123z"/>
<g>
   <polygon style="fill:#E1E6E9;" points="212.508,366.92 192.777,390.896 192.777,366.92 	"/>
   <polygon style="fill:#E1E6E9;" points="275.508,366.92 275.508,390.896 255.778,366.92 	"/>
   <polygon style="fill:#E1E6E9;" points="232.863,366.92 232.863,374.537 226.931,381.468 220.999,374.537 220.999,366.92 	"/>
   <polygon style="fill:#E1E6E9;" points="247.286,366.92 247.286,374.537 241.354,381.468 235.423,374.537 235.423,366.92 	"/>
</g>
<g>
   <path style="fill:#64798A;" d="M327.161,171.012L249.2,223.658c-1.506,1.017-3.433-0.491-2.807-2.198l6.87-18.723
       c9.116-24.726,34.029-39.899,60.191-36.714l12.886,1.577C328.06,167.81,328.597,170.042,327.161,171.012z"/>
   <path style="fill:#64798A;" d="M141.135,171.012l77.961,52.646c1.506,1.017,3.433-0.491,2.807-2.198l-6.87-18.723
       c-9.116-24.726-34.029-39.899-60.191-36.714l-12.886,1.577C140.236,167.81,139.699,170.042,141.135,171.012z"/>
</g>
        </svg>`,
        seer: `<svg version="1.1" id="Capa_2" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
    viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
<g>
   <circle style="fill:#955BA5;" cx="256" cy="167.724" r="167.724"/>
   <g>
       <path style="fill:#CC66A1;" d="M310.934,37.606C293.555,30.249,274.872,26.466,256,26.483c-4.875,0-8.828,3.952-8.828,8.828
           s3.952,8.828,8.828,8.828c16.506-0.025,32.848,3.278,48.049,9.71c1.09,0.458,2.26,0.695,3.443,0.697
           c4.2,0.002,7.819-2.955,8.655-7.071c0.836-4.116-1.344-8.25-5.212-9.887V37.606z"/>
       <path style="fill:#CC66A1;" d="M394.364,139.299c-3.711-18.068-10.943-35.228-21.283-50.503
           c-5.074-7.499-10.849-14.499-17.249-20.904c-3.501-3.081-8.794-2.907-12.085,0.396c-3.292,3.303-3.446,8.597-0.353,12.086
           c5.597,5.616,10.654,11.746,15.104,18.308c13.783,20.383,21.129,44.435,21.089,69.041c0,4.875,3.952,8.828,8.828,8.828
           s8.828-3.952,8.828-8.828C397.246,158.176,396.282,148.652,394.364,139.299z"/>
   </g>
   <path style="fill:#894B9D;" d="M236.182,238.345c-38.974-1.282-69.578-33.831-68.458-72.81c0-48.967,37.402-88.806,83.368-88.806
       c56.249,0,102.012,48.808,102.012,108.8c0,4.875-3.952,8.828-8.828,8.828s-8.828-3.952-8.828-8.828
       c0-50.255-37.844-91.145-84.356-91.145c-36.237,0-65.713,31.921-65.713,71.15c-1.116,29.228,21.582,53.87,50.803,55.155
       c22.394-1.045,39.744-19.972,38.841-42.372c0.694-16.947-12.403-31.285-29.343-32.124c-12.576,0.671-22.263,11.35-21.707,23.932
       c-0.451,9.096,6.515,16.855,15.607,17.382c4.875,0,8.828,3.952,8.828,8.828c0,4.875-3.952,8.828-8.828,8.828
       c-18.845-0.525-33.717-16.19-33.262-35.037c-0.549-22.329,17.037-40.909,39.362-41.587c26.707,0.822,47.73,23.068,47.042,49.779
       C293.624,210.483,268.344,237.322,236.182,238.345z"/>
   <path style="fill:#805333;" d="M459.034,423.724v70.621c-0.029,9.739-7.917,17.626-17.655,17.655H70.621
       c-9.739-0.029-17.626-7.917-17.655-17.655v-70.621H459.034z"/>
   <path style="fill:#CB8252;" d="M317.793,432.552h167.724c9.739-0.029,17.626-7.917,17.655-17.655v-8.828
       c-0.029-9.739-7.917-17.626-17.655-17.655H26.483c-9.739,0.029-17.626,7.917-17.655,17.655v8.828
       c0.029,9.739,7.917,17.626,17.655,17.655h163.31"/>
   <path style="fill:#59474E;" d="M176.552,317.793h158.897c9.751,0,17.655,7.905,17.655,17.655v70.621H158.897v-70.621
       C158.897,325.698,166.801,317.793,176.552,317.793z"/>
   <polygon style="fill:#DF4D60;" points="123.586,388.414 256,476.69 379.586,388.414 	"/>
</g>
        </svg>`,
        cupido: `<svg height="511pt" viewBox="0 -14 511.99893 511" width="511pt" xmlns="http://www.w3.org/2000/svg"><g fill="#937fe6"><path d="m396.984375 341.785156h50.511719c9.136718 0 17.898437 3.632813 24.359375 10.089844l35.789062 35.789062c9.304688 9.304688 2.714844 25.214844-10.445312 25.214844h-29.648438l-71.460937-44.6875zm0 0"/><path d="m369.683594 369.085938v50.507812c0 9.140625 3.632812 17.902344 10.089844 24.363281l35.789062 35.789063c9.304688 9.304687 25.214844 2.714844 25.214844-10.445313v-29.648437l-44.6875-71.460938zm0 0"/><path d="m115.015625 341.785156h-50.511719c-9.136718 0-17.898437 3.632813-24.359375 10.089844l-35.789062 35.789062c-9.304688 9.304688-2.714844 25.21875 10.445312 25.21875h29.648438l71.460937-44.6875zm0 0"/><path d="m142.316406 369.085938v50.507812c0 9.140625-3.632812 17.902344-10.089844 24.363281l-35.789062 35.789063c-9.304688 9.304687-25.214844 2.714844-25.214844-10.445313v-29.648437l44.6875-71.460938zm0 0"/></g><path d="m416.777344 40.550781-372.328125 372.328125c-3.480469 3.480469-3.480469 9.125 0 12.605469l14.167969 14.167969c3.480468 3.480468 9.125 3.480468 12.605468 0l372.328125-372.328125zm0 0" fill="#ff98c9"/><path d="m277.851562 179.472656 26.773438 26.773438-70.480469 70.480468-26.773437-26.773437zm0 0" fill="#eb6da8"/><path d="m477.292969 6.808594c-148.578125-35-156.296875 87.292968-81.996094 81.996094-5.296875 74.296874 117 66.582031 81.996094-81.996094zm0 0" fill="#937fe6"/><path d="m95.222656 40.550781 372.332032 372.332031c3.480468 3.480469 3.480468 9.121094 0 12.601563l-14.171876 14.167969c-3.480468 3.484375-9.121093 3.484375-12.601562 0l-372.335938-372.328125zm0 0" fill="#ff98c9"/><path d="m34.707031 6.808594c148.578125-35 156.296875 87.292968 81.996094 81.996094 5.296875 74.296874-117 66.582031-81.996094-81.996094zm0 0" fill="#937fe6"/></svg>`,
        farmer: `<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
    viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
<path style="fill:#FB403F;" d="M391.79,438.81v65.69c0,4.14-3.36,7.5-7.5,7.5H127.71c-4.14,0-7.5-3.36-7.5-7.5v-65.69
   c0-45.69,37.17-82.87,82.86-82.87h105.86C354.62,355.94,391.79,393.12,391.79,438.81z"/>
<path style="fill:#C21C1C;" d="M308.928,355.944h-28.333c45.689,0,82.861,37.172,82.861,82.862V504.5c0,4.142-3.357,7.5-7.5,7.5
   h28.333c4.143,0,7.5-3.358,7.5-7.5v-65.694C391.789,393.116,354.617,355.944,308.928,355.944z"/>
<path style="fill:#484655;" d="M394.087,150.515c-0.707-3.499-3.782-6.015-7.352-6.015h-261.47c-3.569,0-6.645,2.516-7.352,6.015
   c-7.507,37.149-7.507,74.822,0,111.971c0.707,3.499,3.782,6.015,7.352,6.015h261.471c3.569,0,6.645-2.516,7.352-6.015
   C401.594,225.336,401.594,187.664,394.087,150.515z"/>
<path style="fill:#78D6D1;" d="M369.29,471.67V512H142.71v-40.33c0-4.15,3.36-7.5,7.5-7.5h3.96v-15.71
   c0-9.89,4.33-19.21,11.89-25.57c7.56-6.37,17.49-9.05,27.22-7.37L256,426.36l62.72-10.84c9.73-1.68,19.66,1,27.22,7.37
   c7.56,6.36,11.89,15.68,11.89,25.57v15.71h3.96C365.93,464.17,369.29,467.52,369.29,471.67z"/>
<g>
   <path style="fill:#FA9E3E;" d="M213.904,267.729v90.668c0,23.249,18.847,42.096,42.096,42.096l0,0
       c23.249,0,42.096-18.847,42.096-42.096v-90.668H213.904z"/>
   <path style="fill:#FA9E3E;" d="M125.839,223.99h49.369v56.61h-49.369c-15.632,0-28.305-12.673-28.305-28.305
       S110.207,223.99,125.839,223.99z"/>
   <path style="fill:#FA9E3E;" d="M386.161,223.99h-49.369v56.61h49.369c15.632,0,28.305-12.673,28.305-28.305
       S401.793,223.99,386.161,223.99z"/>
</g>
<path style="fill:#FFB56B;" d="M256,342.79L256,342.79c-61.919,0-112.115-50.195-112.115-112.115V117.281h224.229v113.394
   C368.115,292.595,317.919,342.79,256,342.79z"/>
<path style="fill:#EF9245;" d="M344.781,117.281v125.062c0,53.578-41.949,97.354-94.795,100.286
   c1.992,0.105,3.996,0.161,6.014,0.161l0,0c61.919,0,112.115-50.195,112.115-112.115V117.281H344.781z"/>
<g>
   <path style="fill:#19303F;" d="M310.323,226.962c-4.143,0-7.5-3.358-7.5-7.5v-2c0-4.142,3.357-7.5,7.5-7.5s7.5,3.358,7.5,7.5v2
       C317.823,223.605,314.466,226.962,310.323,226.962z"/>
   <path style="fill:#19303F;" d="M201.677,226.962c-4.143,0-7.5-3.358-7.5-7.5v-2c0-4.142,3.357-7.5,7.5-7.5s7.5,3.358,7.5,7.5v2
       C209.177,223.605,205.819,226.962,201.677,226.962z"/>
   <path style="fill:#19303F;" d="M256,288.484c-13.493,0-26.142-6.631-33.833-17.739c-2.358-3.405-1.509-8.077,1.896-10.435
       c3.403-2.358,8.078-1.509,10.435,1.896c4.891,7.063,12.928,11.279,21.501,11.279s16.61-4.216,21.501-11.279
       c2.357-3.405,7.029-4.254,10.435-1.896c3.405,2.358,4.255,7.03,1.897,10.435C282.142,281.853,269.493,288.484,256,288.484z"/>
</g>
<path style="fill:#D69400;" d="M399.404,165.582l-37.62-133.855C356.533,13.046,339.315,0,319.91,0h-21.718
   c-6.079,0-11.997,1.734-17.114,5.015l-8.116,5.203c-10.305,6.605-23.619,6.605-33.924,0l-8.116-5.203
   C225.805,1.734,219.887,0,213.808,0h-17.347c-19.404,0-36.623,13.046-41.874,31.727l-37.62,133.855
   c-0.635,2.26-0.175,4.688,1.243,6.559c1.418,1.872,3.63,2.971,5.978,2.971h267.996c2.348,0,4.56-1.099,5.978-2.971
   C399.579,170.27,400.039,167.842,399.404,165.582z"/>
<path style="fill:#B77A00;" d="M399.404,165.582l-37.62-133.855C356.533,13.046,339.315,0,319.91,0h-21.718
   c-1.07,0-2.131,0.073-3.187,0.179C312.79,1.784,328.102,14.302,333,31.727l37.62,133.855c0.635,2.26,0.175,4.688-1.243,6.559
   c-1.418,1.872-3.63,2.971-5.978,2.971h28.784c2.348,0,4.56-1.099,5.978-2.971C399.579,170.27,400.039,167.842,399.404,165.582z"/>
<path style="fill:#825939;" d="M399.404,165.582l-16.206-57.662c-0.653-2.323-2.384-4.19-4.651-5.017
   C344.236,90.391,300.716,83.5,256,83.5c-43.026,0-83.672,6.097-117.542,17.633c-2.338,0.796-4.134,2.693-4.803,5.07l-16.689,59.379
   c-0.635,2.26-0.175,4.688,1.243,6.559c1.418,1.872,3.63,2.971,5.978,2.971h267.996c2.348,0,4.56-1.099,5.978-2.971
   C399.579,170.27,400.039,167.842,399.404,165.582z"/>
<path style="fill:#684229;" d="M399.404,165.582l-16.206-57.662c-0.653-2.323-2.384-4.19-4.651-5.017
   c-8.749-3.191-18.103-6.011-27.917-8.45l19.99,71.128c0.635,2.26,0.175,4.688-1.243,6.559c-1.418,1.872-3.63,2.971-5.978,2.971
   h28.784c2.348,0,4.56-1.099,5.978-2.971C399.579,170.27,400.039,167.842,399.404,165.582z"/>
<g>
   <path style="fill:#FFB700;" d="M431.65,139.34c-2.313-6.121-6.871-10.976-12.836-13.669c-5.966-2.693-12.62-2.902-18.742-0.589
       c-92.907,35.105-195.239,35.104-288.145,0c-12.633-4.776-26.801,1.619-31.578,14.257c-2.313,6.122-2.104,12.778,0.589,18.743
       c2.692,5.965,7.548,10.523,13.669,12.836C146.401,190.49,200.701,200.414,256,200.414s109.599-9.924,161.392-29.495
       c6.122-2.313,10.978-6.872,13.67-12.837C433.755,152.117,433.964,145.461,431.65,139.34z"/>
   <circle style="fill:#FFB700;" cx="319.02" cy="457.33" r="13.667"/>
</g>
<path style="fill:#5B5BB2;" d="M319.024,451.167c-4.143,0-7.5-3.358-7.5-7.5v-86c0-4.142,3.357-7.5,7.5-7.5s7.5,3.358,7.5,7.5v86
   C326.524,447.809,323.167,451.167,319.024,451.167z"/>
<circle style="fill:#FFB700;" cx="192.97" cy="457.33" r="13.667"/>
<path style="fill:#5B5BB2;" d="M192.976,451.167c-4.143,0-7.5-3.358-7.5-7.5v-86c0-4.142,3.357-7.5,7.5-7.5s7.5,3.358,7.5,7.5v86
   C200.476,447.809,197.118,451.167,192.976,451.167z"/>
<path style="fill:#3D5868;" d="M283.667,485.833h-55.334c-4.143,0-7.5-3.358-7.5-7.5s3.357-7.5,7.5-7.5h55.334
   c4.143,0,7.5,3.358,7.5,7.5S287.81,485.833,283.667,485.833z"/>
<g>
   <path style="fill:#19303F;" d="M319.024,478.5c-11.671,0-21.166-9.495-21.166-21.167c0-11.671,9.495-21.167,21.166-21.167
       c11.672,0,21.167,9.496,21.167,21.167C340.191,469.005,330.696,478.5,319.024,478.5z M319.024,451.167
       c-3.4,0-6.166,2.767-6.166,6.167s2.766,6.167,6.166,6.167s6.167-2.766,6.167-6.167S322.425,451.167,319.024,451.167z"/>
   <path style="fill:#19303F;" d="M192.976,478.5c-11.672,0-21.167-9.495-21.167-21.167c0-11.671,9.495-21.167,21.167-21.167
       c11.671,0,21.166,9.496,21.166,21.167C214.142,469.005,204.646,478.5,192.976,478.5z M192.976,451.167
       c-3.4,0-6.167,2.767-6.167,6.167s2.767,6.167,6.167,6.167s6.166-2.766,6.166-6.167S196.376,451.167,192.976,451.167z"/>
</g>
        </svg>`,
        hunter: `<svg viewBox="0 0 511.99981 511" xmlns="http://www.w3.org/2000/svg"><path d="m503.148438 510.902344c-1.921876 0-3.839844-.730469-5.304688-2.195313l-492.039062-492.042969c-2.929688-2.929687-2.929688-7.675781 0-10.605468 2.929687-2.929688 7.675781-2.929688 10.605468 0l492.042969 492.039062c2.925781 2.933594 2.925781 7.679688 0 10.609375-1.46875 1.464844-3.386719 2.195313-5.304687 2.195313zm0 0" fill="#c9caca"/><path d="m161.421875 337.960938-32.167969-6.085938c-5.113281-.964844-10.371094.65625-14.050781 4.335938l-51.769531 51.769531c-4.398438 4.398437-2.074219 11.929687 4.039062 13.085937l36.957032 6.992188 6.992187 36.957031c1.15625 6.113281 8.683594 8.4375 13.085937 4.035156l51.769532-51.769531c3.679687-3.679688 5.300781-8.9375 4.332031-14.046875l-6.085937-32.167969c-1.257813-6.648437-6.457032-11.847656-13.101563-13.105468zm0 0" fill="#e15f76"/><path d="m129.253906 331.878906c-5.113281-.96875-10.371094.652344-14.050781 4.332032l-51.769531 51.769531c-4.398438 4.398437-2.074219 11.929687 4.039062 13.085937l36.957032 6.992188 65.5625-65.566406c-2.289063-2.285157-5.25-3.902344-8.574219-4.53125zm0 0" fill="#cb556a"/><path d="m104.429688 415.558594c-1.921876 0-3.839844-.730469-5.304688-2.195313-2.929688-2.929687-2.929688-7.679687 0-10.609375l340.386719-340.386718c2.929687-2.929688 7.679687-2.933594 10.609375 0 2.929687 2.929687 2.929687 7.675781 0 10.605468l-340.390625 340.390625c-1.464844 1.464844-3.382813 2.195313-5.300781 2.195313zm0 0" fill="#7a4f42"/><path d="m199.398438 35.660156h-85.578126c-34.65625 0-68.34375-11.425781-95.851562-32.511718l-.441406-.335938c-4.433594-3.398438-10.519532-2.996094-14.355469.84375-4.230469 4.226562-4.230469 11.082031 0 15.308594l4.957031 4.960937c29.546875 29.546875 69.617188 46.144531 111.402344 46.144531h74.761719c7.390625 0 14.480469 2.9375 19.710937 8.164063l220.25 220.25c5.226563 5.226563 8.164063 12.316406 8.164063 19.710937v74.761719c0 41.78125 16.597656 81.851563 46.140625 111.398438l4.960937 4.960937c4.226563 4.226563 11.082031 4.226563 15.308594 0 3.839844-3.839844 4.242187-9.929687.9375-14.238281l-.433594-.566406c-21.078125-27.503907-32.503906-61.1875-32.503906-95.839844v-85.585937c0-13.246094-5.265625-25.953126-14.632813-35.320313l-113.738281-113.738281-113.734375-113.738282c-9.367187-9.367187-22.074218-14.628906-35.324218-14.628906zm0 0" fill="#9b6a57"/><path d="m507.398438 495.4375-4.960938-4.960938c-29.542969-29.546874-46.140625-69.617187-46.140625-111.402343v-74.761719c0-7.390625-2.9375-14.480469-8.164063-19.710938l-110.125-110.121093-110.125-110.125c-5.226562-5.226563-12.316406-8.164063-19.710937-8.164063h-74.761719c-41.78125 0-81.855468-16.597656-111.398437-46.144531l-4.960938-4.960937c-1.144531-1.140626-1.964843-2.480469-2.492187-3.902344-3.917969-1.441406-8.351563-.5625-11.386719 2.472656-4.230469 4.226562-4.230469 11.082031 0 15.308594l4.957031 4.960937c29.546875 29.546875 69.617188 46.144531 111.402344 46.144531h74.761719c7.390625 0 14.480469 2.9375 19.710937 8.164063l220.25 220.25c5.226563 5.226563 8.164063 12.316406 8.164063 19.710937v74.761719c0 41.78125 16.597656 81.851563 46.140625 111.398438l4.960937 4.960937c4.226563 4.226563 11.082031 4.226563 15.308594 0 3.050781-3.046875 3.921875-7.511718 2.503906-11.378906-1.433593-.523438-2.78125-1.351562-3.933593-2.5zm0 0" fill="#8b5f4e"/><path d="m400.140625 215.054688-24.984375 24.984374c-3.449219 3.453126-9.042969 3.453126-12.492188 0l-90.21875-90.21875c-3.449218-3.449218-3.449218-9.039062 0-12.492187l24.984376-24.984375c3.449218-3.449219 9.042968-3.449219 12.492187 0l90.21875 90.21875c3.449219 3.453125 3.449219 9.042969 0 12.492188zm0 0" fill="#f9993e"/><path d="m376.542969 226.160156-90.21875-90.21875c-3.449219-3.449218-3.449219-9.042968 0-12.492187l-13.878907 13.878906c-3.449218 3.453125-3.449218 9.042969 0 12.492187l90.21875 90.21875c3.449219 3.453126 9.042969 3.453126 12.492188 0l13.878906-13.878906c-3.449218 3.449219-9.039062 3.449219-12.492187 0zm0 0" fill="#e58d39"/><path d="m489.9375 14.40625-80.449219 30.449219c-4.292969 1.625-5.476562 7.132812-2.230469 10.375l24.996094 25 25 25c3.242188 3.242187 8.753906 2.058593 10.375-2.230469l30.453125-80.449219c1.925781-5.089843-3.054687-10.074219-8.144531-8.144531zm0 0" fill="#c9caca"/><path d="m489.9375 14.40625-80.449219 30.449219c-4.292969 1.625-5.476562 7.132812-2.230469 10.375l24.996094 25 64.386719-64.382813c-1.640625-1.644531-4.160156-2.40625-6.703125-1.441406zm0 0" fill="#b7b7b7"/><g fill="#d3792f"><path d="m400.933594 203.480469-54.15625 20.675781-11.960938-11.960938 54.230469-20.726562 11.09375 11.09375c.289063.289062.558594.597656.792969.917969zm0 0"/><path d="m369.390625 171.8125-54.226563 20.726562-11.972656-11.96875 54.230469-20.71875zm0 0"/><path d="m337.765625 140.195312-54.230469 20.71875-11.09375-11.09375c-.289062-.289062-.546875-.589843-.78125-.90625l54.132813-20.6875zm0 0"/></g></svg>`,
        witch: `<svg id="Capa_1" enable-background="new 0 0 497.237 497.237" height="512" viewBox="0 0 497.237 497.237" width="512" xmlns="http://www.w3.org/2000/svg"><g><path d="m388.238 341.076c64.642 15.432 107.035 41.279 107.035 70.565 0 47.273-110.431 85.596-246.654 85.596s-246.654-38.322-246.654-85.595c0-30.122 44.842-56.606 112.617-71.861l112.049-10.655h110.963z" fill="#bd80e1"/><g><g><g id="XMLID_171_"><g><path d="m409.218 346.683c-6.693-1.994-13.694-3.867-20.98-5.607l-50.644-11.951h-106.025-4.939l-112.049 10.655c-67.774 15.256-112.616 41.74-112.616 71.862 0 47.273 110.431 85.596 246.654 85.596 31.233 0 61.102-2.02 88.603-5.695-10.066.434-20.318.66-30.722.66-136.223 0-246.654-38.323-246.654-85.596 0-11.857 6.95-23.15 19.512-33.416 4.357-3.561 10.853-.206 10.359 5.399-.477 5.406-.886 10.856-1.219 16.351-.786 12.667 6.43 24.739 17.962 30.042 27.307 12.545 55.054 21.624 82.471 26.984l1.841.36 115.454.703 1.849-.339c29.015-5.318 58.381-14.792 87.275-28.158 11.222-5.186 18.273-16.517 17.964-28.859-.403-16.275-1.856-32.675-4.096-48.991z" fill="#af66da"/><path d="m149.321 397.985 203.581-2.847 35.834-50.743c-12.643-85.981-48.084-169.442-72.02-218.479-1.419-2.908.888-6.243 4.11-5.946l66.273 6.11c16.81 1.54 26.15-18.97 13.95-30.63l-92.04-87.95c-5.03-4.81-11.73-7.5-18.69-7.5-3.86 0-7.63.82-11.07 2.37-3.45 1.54-6.57 3.8-9.13 6.68-29.746 33.417-129.972 157.345-156.336 336.115z" fill="#cb97e7"/></g><g><g><path d="m315.758 126.154c-2.756 0-5.407-1.523-6.719-4.157-11.534-23.155-19.768-37.179-19.85-37.318-2.101-3.569-.912-8.167 2.657-10.268 3.57-2.103 8.165-.912 10.268 2.655.344.584 8.559 14.569 20.351 38.243 1.848 3.708.339 8.21-3.369 10.058-1.073.533-2.215.787-3.338.787z" fill="#af66da"/></g></g></g></g><path d="m309.009 7.5c-5.03-4.81-11.73-7.5-18.69-7.5-3.86 0-7.63.82-11.07 2.37-3.45 1.54-6.57 3.8-9.13 6.68-29.747 33.417-129.975 157.348-156.337 336.122l14.278 30.624 33.264-12.554c27.25-176.627 126.217-298.958 155.742-332.126 2.56-2.88 5.68-5.14 9.13-6.68.123-.055.249-.103.373-.156z" fill="#bd80e1"/><g id="XMLID_172_"><g><path d="m114.809 345.55c26.29 12.08 52.58 20.64 78.86 25.69l36.12 9.07h42.67l31.29-8.43c27.74-5.01 55.47-13.93 83.21-26.76l1.78-.73c2.54 17.24 4.16 34.59 4.58 51.78.11 4.36-2.4 8.38-6.36 10.21-27.5 12.72-54.99 21.6-82.49 26.64l-111.7-.68c-25.98-5.08-51.97-13.59-77.96-25.53-4.11-1.89-6.63-6.12-6.35-10.63 1.06-17.44 2.869-34.506 5.309-51.036z" fill="#bc7c63"/></g></g><g id="XMLID_173_"><g><path d="m304.469 376.94v62.41c0 10.26-8.32 18.58-18.58 18.58h-74.54c-10.26 0-18.58-8.32-18.58-18.58v-62.41c0-10.26 8.32-18.58 18.58-18.58h74.54c10.26 0 18.58 8.32 18.58 18.58zm-30 47.006v-31.602c0-2.2-1.784-3.984-3.984-3.984h-43.732c-2.2 0-3.984 1.784-3.984 3.984v31.602c0 2.2 1.784 3.984 3.984 3.984h43.732c2.2 0 3.984-1.784 3.984-3.984z" fill="#fee97d"/></g></g><g><path d="m239.793 415.647h-55.498c-4.142 0-7.5-3.358-7.5-7.5s3.358-7.5 7.5-7.5h55.498c4.142 0 7.5 3.358 7.5 7.5s-3.358 7.5-7.5 7.5z" fill="#fef0ae"/></g></g><path d="m161.322 363.242c-15.503-4.678-31.008-10.568-46.514-17.692l-1.041-.406c-2.44 16.53-4.249 33.596-5.309 51.036-.28 4.51 2.24 8.74 6.35 10.63 13.776 6.329 27.552 11.684 41.327 16.085-.565-1.451-.83-3.031-.729-4.649 1.145-18.864 3.17-37.207 5.916-55.004z" fill="#aa6a51"/></g></svg>`
    }
    //#endregion

let cupidoPickedAmnt = 0;
let cupidoPickedIds = [];
/**
 * @param {UserPicker} UserPicker - De picker
 * @param {HTMLElement} button - De knop waarop geklikt is
 * @param {Array} user - de gebruiker gelinkt aan de knop
 * @param {WebSocket} socket - De Socket
 */
function UserPickerClick(UserPicker, button, user, socket) {
    if (UserPicker.isDay) {
        UserPicker.children.forEach(child => {
            child.querySelector('button').disabled = true;
        })
        button.style.background = "hsla(342, 97%, 62%, 0.3)";
        socket.emit('!g-user-vote', user);
    } else {
        switch (UserPicker.mode) {
            case "cupido":
                cupidoPickedAmnt++;
                // UserPicker.children.forEach(child => {
                //     child.querySelector('button').style.background = "";
                // })
                button.style.background = "hsla(342, 97%, 62%, 0.3)";
                cupidoPickedIds.push(button.dataset.userid);
                if (cupidoPickedAmnt >= 2) {
                    socket.emit('!g-cupido-choose', cupidoPickedIds);
                    UserPicker.mode = "farmer"; // Set user to farmer after chosing lovers
                    UserPicker.hide()
                }
                break;
            case "werewolf":
                UserPicker.children.forEach(child => {
                    child.querySelector('button').disabled = true;
                })
                button.style.background = "hsla(342, 97%, 62%, 0.3)";
                socket.emit('!g-werewolf-vote', user)
                break;
            case "witch":
                if (UserPicker.witchAction !== 3) { // Selected action
                    UserPicker.witchActionBar.classList.add('hidden')
                    if (UserPicker.witchAction == 0) { // Kill
                        document.querySelectorAll('.witch-picker-button')[0].disabled = true;
                        UserPicker.children.forEach(child => {
                            child.querySelector('button').disabled = true;
                        })
                        button.style.background = "hsla(342, 97%, 62%, 0.3)";
                        socket.emit('!g-witch-choose', { action: 0, id: button.dataset.userid })
                        setTimeout(() => { UserPicker.hide() }, 1500);
                    }
                    if (UserPicker.witchAction == 1) { // Skip
                        UserPicker.hide();
                    }
                    if (UserPicker.witchAction == 2) { // Heal
                        document.querySelectorAll('.witch-picker-button')[2].disabled = true;
                        UserPicker.children.forEach(child => {
                            child.querySelector('button').disabled = true;
                        })
                        button.style.background = "hsla(342, 97%, 62%, 0.3)";
                        socket.emit('!g-witch-choose', { action: 0, id: button.dataset.userid })
                        setTimeout(() => { UserPicker.hide() }, 1500);
                    }
                } else { // Not selected action
                    document.querySelector('.overlay-witch').innerHTML = "<b>Selecteer eerst een actie!</b>";
                    setTimeout(() => {
                        document.querySelector('.overlay-witch').innerHTML = ""
                    }, 1500)
                }
                break;
            case "seer":
                UserPicker.children.forEach(child => {
                    child.querySelector('button').disabled = true;
                })
                button.style.background = "hsla(342, 97%, 62%, 0.3)";
                document.querySelector('.overlay-seer').querySelector('.svg-icon').innerHTML = rolesSVG[user.role]
                document.querySelector('.overlay-seer').querySelector('.svg-icon').classList.add('show')
                setTimeout(() => {
                    document.querySelector('.overlay-seer').querySelector('.svg-icon').classList.remove('show')
                    document.querySelector('.overlay-seer').querySelector('.svg-icon').innerHTML = ""
                    UserPicker.hide();
                }, 2500)
                break;
        }
    }
}

/**
 * @param {UserPicker} UserPicker
 * @param {Array} votes
 */
function updateVotesUI(UserPicker, votes){
    UserPicker.children.forEach(child => {
        let btn = child.querySelector('button');
        const vote = votes.find(v => v.uuid == btn.dataset.userid)
        btn.querySelector('.userVotes').textContent = vote ? vote.amount : "";
    })
}

/**
 * @param {UserPicker} UserPicker
*/
function hunter(UserPicker){
    UserPicker.show()

    UserPicker.children.forEach(child => {
        /**
         * @type {HTMLButtonElement} 
         */
        let btn = child.querySelector('button');
        
        btn.removeEventListener('click')
        btn.addEventListener('click', () => {
            UserPicker.children.forEach(child => {
                child.querySelector('button').disabled = true;
            })
            button.style.background = "hsla(342, 97%, 62%, 0.3)";
            socket.emit('!g-hunter-choose', { id: button.dataset.userid })
            socket.emit('!a-send-deaths')
            setTimeout(() => { 
                UserPicker.hide()
                UserPicker.die()
            }, 1500);
        })
    })
}